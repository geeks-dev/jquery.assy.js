/* jquery assy - v1.0.0 - 2014-02-04
* https://github.com/geeks-dev/jquery.assy.js
* Copyright (c) 2014 kaz; Licensed MIT */
(function(assy){"use strict";assy(window.jQuery,window,document)}(function($,window,document,undefined){"use strict";var assClassName="assy",assClass="."+assClassName,insertTagClass="assy-insert",headerClassName="assy-header",headerClass="."+headerClassName,subheaderClassName="assy-subheader",subheaderClass="."+subheaderClassName,itemClassName="assy-item",itemClass="."+itemClassName,extendPageClassName="assy-extend-page",extendPageClass="."+extendPageClassName;$.widget("ass.assy",{version:"1.9.0",options:{context:"body",ignoreSelector:null,selectors:"h1, h2, h3",showAndHide:true,navClass:'',scrollTo:0,extendPage:true,extendPageOffset:100,history:true,scrollHistory:false,hashGenerator:"compact",highlightDefault:true},_create:function(){var self=this;self.extendPageScroll=true;self.items=[];self._generateAss();self.webkit=(function(){for(var prop in window){if(prop){if(prop.toLowerCase().indexOf("webkit")!==-1){return true}}}return false}());$(window).load(function(){self._setActiveElement(true)})},_generateAss:function(){var self=this,firstElem,ul,ignoreSelector=self.options.ignoreSelector;if(this.options.selectors.indexOf(",")!==-1){firstElem=$(this.options.context).find(this.options.selectors.replace(/ /g,"").substr(0,this.options.selectors.indexOf(",")))}else{firstElem=$(this.options.context).find(this.options.selectors.replace(/ /g,""))}self.element.addClass(assClassName);ul=$("<ul/>",{"class":headerClassName+' nav '+this.options.navClass});self.element.append(ul);firstElem.each(function(index){if($(this).is(ignoreSelector)){return}ul.append(self._nestElements($(this),index));$(this).nextUntil(this.nodeName.toLowerCase()).each(function(){if($(this).find(self.options.selectors).length===0){$(this).filter(self.options.selectors).each(function(){if($(this).is(ignoreSelector)){return}self._appendSubheaders.call(this,self,ul)})}else{$(this).find(self.options.selectors).each(function(){if($(this).is(ignoreSelector)){return}self._appendSubheaders.call(this,self,ul)})}})})},_setActiveElement:function(pageload){var self=this;self.element.find(itemClass).first().addClass("active");return self},_nestElements:function(self,index){var arr,item,hashValue;arr=$.grep(this.items,function(item){return item===self.text()});if(arr.length){this.items.push(self.text()+index)}else{this.items.push(self.text())}hashValue=this._generateHashValue(arr,self,index);item=$("<li/>",{"class":itemClassName,"data-unique":hashValue}).append($("<a/>",{"href":'#'+hashValue,"text":self.text()}));self.before($("<div/>",{"name":hashValue,"id":hashValue,"data-unique":hashValue,"class":insertTagClass,"style":"margin-top: -"+this.options.scrollTo+"px;padding-top:"+this.options.scrollTo+"px"}));return item},_generateHashValue:function(arr,self,index){var hashValue="",hashGeneratorOption=this.options.hashGenerator;if(hashGeneratorOption==="pretty"){hashValue=self.text().toLowerCase().replace(/\s/g,"-");while(hashValue.indexOf("--")>-1){hashValue=hashValue.replace(/--/g,"-")}while(hashValue.indexOf(":-")>-1){hashValue=hashValue.replace(/:-/g,"-")}}else if(typeof hashGeneratorOption==="function"){hashValue=hashGeneratorOption(self.text(),self)}else{hashValue=self.text().replace(/\s/g,"")}if(arr.length){hashValue+=""+index}return hashValue},_appendSubheaders:function(self,ul){var index=$(this).index(self.options.selectors),previousHeader=$(self.options.selectors).eq(index-1),currentTagName=+$(this).prop("tagName").charAt(1),previousTagName=+previousHeader.prop("tagName").charAt(1),lastSubheader;if(currentTagName<previousTagName){self.element.find(subheaderClass+"[data-tag="+currentTagName+"]").last().append(self._nestElements($(this),index))}else if(currentTagName===previousTagName){ul.find(itemClass).last().after(self._nestElements($(this),index))}else{ul.find(itemClass).last().append($("<ul/>",{"class":subheaderClassName+' nav',"data-tag":currentTagName,html:self._nestElements($(this),index)}))}},setOption:function(){$.Widget.prototype._setOption.apply(this,arguments)},setOptions:function(){$.Widget.prototype._setOptions.apply(this,arguments)},})}));